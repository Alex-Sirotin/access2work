# üöÄ Access2Work

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SoftEther VPN —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π OTP, —Å—Ç—Ä–æ–≥–∏–º –ø–æ—Ä—è–¥–∫–æ–º, –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º IP. –†–∞–±–æ—Ç–∞–µ—Ç –≤ Docker/Podman –Ω–∞ Windows/Linux/WSL.

---

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env`](#Ô∏è-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-—á–µ—Ä–µ–∑-env)
- [üìÅ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VPN](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-vpn)
- [üìÅ –°–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏](#-—Å–≤—è–∑—å-–º–µ–∂–¥—É-–∫–æ–Ω—Ñ–∏–≥–∞–º–∏-–∏-–ø—Ä–æ—Ñ–∏–ª—è–º–∏)
- [üîê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (`make seal`)](#-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-—Å–µ–∫—Ä–µ—Ç–æ–≤-make-seal)
- [üß≠ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è](#-–ø–æ—à–∞–≥–æ–≤–∞—è-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- [üê≥ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞](#-—Å–±–æ—Ä–∫–∞-–∏-–∑–∞–ø—É—Å–∫-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
- [üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è](#-–ø—Ä–æ–≤–µ—Ä–∫–∞-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- [üß© –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
- [üì¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å](#-–æ–±—Ä–∞—Ç–Ω–∞—è-—Å–≤—è–∑—å)

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Access2Work/
‚îú‚îÄ‚îÄ dial.py                       # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPN
‚îú‚îÄ‚îÄ seal.py                       # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ TOTP-—Å–µ–∫—Ä–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ vpn_configs/                  # JSON-—Ñ–∞–π–ª—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ VPN1.json
‚îÇ   ‚îî‚îÄ‚îÄ VPN2.json
‚îú‚îÄ‚îÄ vpn_profiles/                 # .vpn-—Ñ–∞–π–ª—ã —Å —Å–µ—Ç–µ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ SoftEther
‚îÇ   ‚îú‚îÄ‚îÄ VPN1.vpn
‚îÇ   ‚îî‚îÄ‚îÄ VPN2.vpn
‚îú‚îÄ‚îÄ secrets/                      # –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ TOTP-—Å–µ–∫—Ä–µ—Ç—ã (.gpg)
‚îÇ   ‚îú‚îÄ‚îÄ VPN1.secret.gpg
‚îÇ   ‚îî‚îÄ‚îÄ VPN2.secret.gpg
‚îú‚îÄ‚îÄ .env                          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É—Ç–µ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ Dockerfile                    # –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ Makefile                      # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞
‚îî‚îÄ‚îÄ README.md                     # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env`

```dotenv
MAX_RETRIES=5
OTP_VALIDITY=30
VPN_CONFIG_DIR=/vpn/vpn_configs
VPN_PROFILE_DIR=/vpn/vpn_profiles
VPN_SECRET_DIR=/vpn/secrets
LOG_PATH=/vpn/vpn_connect.log
ENABLE_LOG=true
STOP_ON_FAILURE=true
```

---

## üìÅ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VPN

### `vpn_configs/VPN1.json`

```json
{
  "Order": 1,
  "Username": "user1",
  "Prefix": "ABC123",
  "OtpAuthUrl": "otpauth://totp/Example?secret=2ZJOUUQEJEBF7FEAXX3BKMBPUECRQCRL&issuer=Example"
}
```

---

## üìÅ –°–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏

–°–∫—Ä–∏–ø—Ç `dial.py` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ `.vpn`-—Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç `*.json` –≤ `vpn_configs/`.

- `vpn_configs/VPN1.json` ‚Üí —Ç—Ä–µ–±—É–µ—Ç `vpn_profiles/VPN1.vpn`
- `vpn_profiles/VPN3.vpn` –±–µ–∑ `VPN3.json` ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

---

## üîê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (`make seal`)

–ö–æ–º–∞–Ω–¥–∞ `make seal`:

- –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º `vpn_configs/*.json`
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç `OtpAuthUrl`
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `.secret.gpg` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ VPN
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `secrets/<VPN_NAME>.secret.gpg`

---

## üß≠ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### üîπ –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ VPN-–ø—Ä–æ—Ñ–∏–ª–∏

```bash
vpncmd localhost /CLIENT /CMD AccountExport VPN1 /FILE:VPN1.vpn
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.vpn` —Ñ–∞–π–ª –≤ `vpn_profiles/`.

---

### üîπ –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```json
{
  "Order": 1,
  "Username": "user1",
  "Prefix": "ABC123",
  "OtpAuthUrl": "otpauth://totp/Example?secret=...&issuer=..."
}
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ `vpn_configs/VPN1.json`.

---

### üîπ –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env`

```dotenv
VPN_CONFIG_DIR=/vpn/vpn_configs
VPN_PROFILE_DIR=/vpn/vpn_profiles
VPN_SECRET_DIR=/vpn/secrets
LOG_PATH=/vpn/vpn_connect.log
ENABLE_LOG=true
STOP_ON_FAILURE=true
MAX_RETRIES=5
OTP_VALIDITY=30
```

---

### üîπ –®–∞–≥ 4: –°–æ–±–µ—Ä–∏—Ç–µ Docker-–æ–±—Ä–∞–∑

```bash
make build
```

---

### üîπ –®–∞–≥ 5: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ OTP-—Å–µ–∫—Ä–µ—Ç—ã

```bash
make seal
```

---

### üîπ –®–∞–≥ 6: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```bash
make run
```

---

### üîπ –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥

```
[VPN1] ‚úÖ Connected
[VPN1] üåê IP before: 185.12.34.56, IP after: 10.8.0.2
```

---

### üîπ –®–∞–≥ 8: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
make stop
```

---

### üîπ –®–∞–≥ 9: –û—á–∏—Å—Ç–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

```bash
make clean
```

---

## üê≥ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
make build     # –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞
make seal      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
make run       # –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make stop      # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make clean     # –û—á–∏—Å—Ç–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
make rebuild   # –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

- –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç IP –¥–æ –∏ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (`https://ifconfig.me`)
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `vpn_connect.log` (–µ—Å–ª–∏ ENABLE_LOG=true)

---

## üß© –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö VPN —Å –ø–æ—Ä—è–¥–∫–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è: `prefix + OTP`
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ (`.gpg`)
- –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å: Windows, Linux, WSL, Nano Server
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Podman
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Makefile
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ IP –∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## üì¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É OpenVPN, GUI, systemd –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å cloud-init? –§–æ—Ä–∫–Ω–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ –æ—Ç–∫—Ä–æ–π issue.

---
