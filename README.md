# üõ°Ô∏è Access2Work ‚Äî VPN-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π

–ü—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPN —á–µ—Ä–µ–∑ OpenVPN —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π OTP, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–æ–≤, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π —Å–µ—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ Makefile.

---

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env`](#Ô∏è-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-—á–µ—Ä–µ–∑-env)
- [üìÅ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VPN](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-vpn)
- [üìÅ –°–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏](#-—Å–≤—è–∑—å-–º–µ–∂–¥—É-–∫–æ–Ω—Ñ–∏–≥–∞–º–∏-–∏-–ø—Ä–æ—Ñ–∏–ª—è–º–∏)
- [üìÅ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞](#-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
- [üß© –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
- [üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Makefile](#-–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã-makefile)
- [üõ†Ô∏è –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-—Å—Ü–µ–Ω–∞—Ä–∏–∏-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Access2Work/
‚îú‚îÄ‚îÄ dial.py                       # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPN
‚îú‚îÄ‚îÄ seal.py                       # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ TOTP-—Å–µ–∫—Ä–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ vpn-diag.sh                   # Bash-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ VPN
‚îú‚îÄ‚îÄ requirements.txt              # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ vpn_configs/                  # JSON-—Ñ–∞–π–ª—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ VPN1.json
‚îÇ   ‚îî‚îÄ‚îÄ VPN2.json
‚îú‚îÄ‚îÄ vpn_profiles/                 # .ovpn-—Ñ–∞–π–ª—ã —Å —Å–µ—Ç–µ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ SoftEther
‚îÇ   ‚îú‚îÄ‚îÄ VPN1.ovpn
‚îÇ   ‚îî‚îÄ‚îÄ VPN2.ovpn
‚îú‚îÄ‚îÄ secrets/                      # –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ TOTP-—Å–µ–∫—Ä–µ—Ç—ã (.gpg)
‚îÇ   ‚îú‚îÄ‚îÄ VPN1.secret.gpg
‚îÇ   ‚îî‚îÄ‚îÄ VPN2.secret.gpg
‚îú‚îÄ‚îÄ .env                          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É—Ç–µ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ Dockerfile                    # –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ Makefile                      # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞
‚îî‚îÄ‚îÄ README.md                     # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env`

```dotenv
MAX_RETRIES=5
OTP_VALIDITY=30
VPN_CONFIG_DIR=/vpn/vpn_configs
VPN_PROFILE_DIR=/vpn/vpn_profiles
VPN_SECRET_DIR=/vpn/secrets
LOG_PATH=/vpn/vpn_connect.log
ENABLE_LOG=true
STOP_ON_FAILURE=true
IMAGE_NAME=access2work
CONTAINER_NAME=access2work_container
SEAL_MODE=normal
RUN_MODE=detached
KEEP_ALIVE=true
```

---

## üìÅ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VPN

### `vpn_configs/VPN1.json`

```json
{
  "Order": 1,
  "Username": "user1",
  "Prefix": "ABC123",
  "OtpAuthUrl": "otpauth://totp/Example?secret=2ZJOUUQEJEBF7FEAXX3BKMBPUECRQCRL&issuer=Example"
}
```

---

## üìÅ –°–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏

–°–∫—Ä–∏–ø—Ç `dial.py` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ `.ovpn`-—Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç `*.json` –≤ `vpn_configs/`.

- `vpn_configs/VPN1.json` ‚Üí —Ç—Ä–µ–±—É–µ—Ç `vpn_profiles/VPN1.ovpn`
- `vpn_profiles/VPN3.ovpn` –±–µ–∑ `VPN3.json` ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

---

## üß™ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

- `dial.py` –ª–æ–≥–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ IP
- `vpn-diag.sh` –∏ `make diag` –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –º–∞—Ä—à—Ä—É—Ç—ã, –ø—Ä–æ—Ü–µ—Å—Å—ã

---

## üß© –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö VPN —Å –ø–æ—Ä—è–¥–∫–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è: `prefix + OTP`
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ (`secrets/*.gpg`)
- –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å: Windows, Linux, WSL, Nano Server
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Podman
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Makefile
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ IP –∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `seal.py` —Å `GPG_PASSPHRASE`
- `.auth` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ –∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Makefile

| –ö–æ–º–∞–Ω–¥–∞         | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------------|----------|
| `make build`   | –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ |
| `make run`     | –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (`RUN_MODE=debug|detached`) |
| `make seal`    | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ (`SEAL_MODE=normal|force|dryrun`) |
| `make status`  | –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ç–∏ –∏ VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ |
| `make diag`    | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ VPN |
| `make stop`    | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `make clean`   | –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ |
| `make logs`    | –í—ã–≤–æ–¥ –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `make ps`      | –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ |
| `make rebuild` | –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ |
| `make debug`   | –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤ debug-—Ä–µ–∂–∏–º–µ |
| `make help`    | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |

---

## üõ†Ô∏è –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üöÄ –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –ø–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```bash
cp Makefile.env.sample .env         # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
make clean                          # –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
make build                          # –°–æ–±—Ä–∞—Ç—å Docker-–æ–±—Ä–∞–∑
make run                            # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
make seal                           # –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã
make diag                           # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å VPN –∏ —Å–µ—Ç—å
```

---

### üß≠ –ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞)

–î–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```bash
make run                            # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
make status                         # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –º–∞—Ä—à—Ä—É—Ç—ã
make logs                           # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
make diag                           # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```

---

### üß™ –û—Ç–ª–∞–¥–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ VPN-–ø—Ä–æ—Ñ–∏–ª–µ–π:

```bash
make debug                          # –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
python3 /vpn/dial.py                # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é
bash /vpn/vpn-diag.sh               # –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä—É—á–Ω—É—é

# –°–Ω–∞—Ä—É–∂–∏:
make logs                           # –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make ps                             # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```

---
